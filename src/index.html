<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Block documentation</title>

	<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/fetch/2.0.2/fetch.min.js"></script>


	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">

	<style>
		body {
			padding-top: 10px;
		}

		td .table {
			margin-left: 50px;
			width: calc(100% - 50px);
			margin-bottom: 0;
		}

		.list-group {
			text-transform: capitalize;
		}
	</style>
</head>
<body>

<div class="container-fluid viewmodel">
	<div class="col-md-3 hidden-xs hidden-sm">
		<h2>Documentation</h2>
		<!-- ko foreach: Object.keys($data) -->
			<!-- ko if: $parent[$data]().length -->
				<div class="list-group">
					<span class="list-group-item">
						<span class="badge" data-bind="text: $parent[$data]().length"></span>
						<span class="list-group-item-heading">
						    <h4 class="list-group-item-heading" data-bind="html: $data"></h4>
						</span>
					</span>
					<!-- ko foreach: $parent[$data] -->
						<a href="#" class="list-group-item" data-bind="attr: {href: '#' + ($data.blockId || $data.name)}, html: $data.blockId || $data.name"></a>
					<!-- /ko -->
				</div>
			<!-- /ko -->
		<!-- /ko -->
	</div>

	<div class="col-md-9">
		<div class="starter-template">
			<h2 id="blocks">Blocks</h2>

			<!-- ko if: blocks().length -->
			<div class="blocks" data-bind="foreach: blocks">
				<div class="panel panel-default" data-bind="attr: {'id': $data.blockId}">
					<div class="panel-heading">
						<h3 class="panel-title" data-bind="html: $data.blockId"></h3>
					</div>
					<div class="panel-body table-responsive">
						<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
					</div>
					<div class="panel-body panel-responsive">
						<h5>Example JSON</h5>
						<pre><code class="json-example" data-bind="html: $data.example"></code></pre>
					</div>
				</div>
			</div>
			<!-- /ko -->

			<!-- ko if: references().length -->
			<h2 id="references">References</h2>
			<div class="blocks" data-bind="foreach: references">
				<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
					<div class="panel-heading">
						<h3 class="panel-title" data-bind="html: $data.name"></h3>
					</div>
					<div class="panel-body table-responsive">
						<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
					</div>
				</div>
			</div>
			<!-- /ko -->

			<!-- ko if: enums().length -->
			<h2 id="enums">Enums</h2>
			<div class="blocks" data-bind="foreach: enums">
				<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
					<div class="panel-heading">
						<h3 class="panel-title" data-bind="html: $data.name"></h3>
					</div>
					<div class="panel-body table-responsive">
						<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
					</div>
				</div>
			</div>
			<!-- /ko -->

			<!-- ko if: files().length -->
			<h2 id="files">Files</h2>
			<div class="blocks" data-bind="foreach: files">
				<div class="panel panel-default" data-bind="attr: {'id': $data.name}">
					<div class="panel-heading">
						<h3 class="panel-title" data-bind="html: $data.name"></h3>
					</div>
					<div class="panel-body table-responsive">
						<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
					</div>
					<div class="panel-body panel-responsive">
						<h5>Example JSON</h5>
						<pre><code class="json-example" data-bind="html: $data.example"></code></pre>
					</div>
				</div>
			</div>
			<!-- /ko -->
		</div>
	</div>


	<script type="text/html" id="table">
		<table class="table">
			<thead>
				<tr data-bind="foreach: Object.keys($data[0] || {})">
					<!-- ko if: skippedProperties.indexOf($data) == -1 -->
						<th data-bind="html: $data"></th>
					<!-- /ko -->
				</tr>
			</thead>
			<tbody data-bind="foreach: $data">

				<tr data-bind="foreach: Object.keys($data)">

					<!-- ko if: skippedProperties.indexOf($data) == -1 -->

						<td>
							<!-- ko if: $data === 'value' -->
								<code data-bind="html: $parent[$data]"></code>
							<!-- /ko -->

							<!-- ko if: $data === 'defaultValue' -->
								<var data-bind="html: $parent[$data]"></var>
							<!-- /ko -->

							<!-- ko if: $data === 'type' -->

								<!-- ko if: types.indexOf($parent[$data]) > -1 -->
									<code data-bind="text: $parent[$data]"></code>
								<!-- /ko -->

								<!-- ko if: types.indexOf($parent[$data]) === -1 -->
									<a data-bind="text: $parent[$data], attr: {'href': '#' + $parent[$data]}"></a>
								<!-- /ko -->

							<!-- /ko -->

							<!-- ko if: $data === 'required' -->
								<span class="btn btn-default btn-sm disabled" data-bind="text: $parent[$data], css: {'btn-danger':  $parent[$data]}"></span>
							<!-- /ko -->

							<!-- ko if: $data !== 'value' && $data !== 'type' && $data !== 'required' && $data !== 'defaultValue' -->
								<span data-bind="html: $parent[$data]"></span>
							<!-- /ko -->
						</td>
					<!-- /ko -->
				</tr>

				<!-- ko if: $data.properties && $data.properties.length -->
					<tr>
						<td colspan="4" data-bind="attr: {colspan: Object.keys($data).length - skippedProperties.length}">
							<!-- ko template: {name: 'table', data: $data.properties} --><!--/ko -->
						</td>
					</tr>
				<!-- /ko -->

			</tbody>
		</table>
</script>

</div><!-- /.container -->
<script>
	var types = ['string', 'boolean', 'Array', 'Object', 'number', 'any'];
	var skippedProperties = ['placeholder', 'properties'];

	// Check fetch support
	if( self.fetch )
	{
		// Create a simple viewmodel
		var ViewModel = function( data )
		{
			this.blocks = ko.observableArray( data.blocks );
			this.references = ko.observableArray( data.references );
			this.enums = ko.observableArray( data.enums );
			this.files = ko.observableArray( data.files );
		};

		// Create the request
		var request = new Request( 'data.json', {
			method: 'GET',
			headers: new Headers( {
				'Content-Type': 'text/plain'
			} )
		} );

		// Fetch the json file
		fetch( request )
			.then( function( response )
			{
				return response.json();
			} )
			.then( function( response )
			{
				// Apply knockout binding for rendering of the html
				ko.applyBindings( new ViewModel( response ), document.body );

				document.body.querySelectorAll( '.json-example' ).forEach( function( block )
				{
					hljs.highlightBlock( block );
				} )
			} )
	}
	else
	{
		alert( 'Fetch not supported!' );
	}
</script>
</body>
</html>